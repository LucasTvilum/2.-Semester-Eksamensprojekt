@using ClientApp.Service
@inject NavigationManager navigationManager
@inject UserState userState
@inject Blazored.LocalStorage.ILocalStorageService localStorage

<div class="topbar">

    <div class="logo">Tvilum</div>

    <div class="d-flex flex-column align-items-end me-3">

        <img src="image/Logo/ProfileLogo.png"
             style="width:50px; height:50px; cursor:pointer;"
             @onclick="ToggleProfile" />

        @if (userState.IsLoggedIn)
        {
            <span class="fw-bold mt-1" style="font-size: 0.95rem;">
                Velkommen, @userState.CurrentUser.Name
            </span>
        }

        @if (showProfileMenu)
        {
            <div class="profile-menu">
                @if (userState.IsLoggedIn)
                {
                    <button class="profile-menu-btn" @onclick="Logout">Log ud</button>
                }
                else
                {
                    <button class="profile-menu-btn" @onclick="GoToRegister">Opret bruger</button>
                    <button class="profile-menu-btn" @onclick="GoToLogin">Log ind</button>
                }
            </div>
        }
    </div>
</div>

@code {
    private bool showProfileMenu = false;

    void ToggleProfile()
    {
        showProfileMenu = !showProfileMenu;
    }

    void GoToLogin()
    {
        navigationManager.NavigateTo("/Login");
    }

    void GoToRegister()
    {
        navigationManager.NavigateTo("/Register");
    }

    private async Task Logout()
    {
        await localStorage.RemoveItemAsync("currentUser");
        userState.CurrentUser = null;
        showProfileMenu = false;
        navigationManager.NavigateTo("/Home", true);
    }
}