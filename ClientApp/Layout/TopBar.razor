@using ClientApp.Service
@inject NavigationManager navigationManager
@inject UserState userState
@inject Blazored.LocalStorage.ILocalStorageService localStorage

<div class="topbar">

    <!-- LEFT: HAMBURGER -->
    <div class="topbar-left">
        <button class="menu-button" @onclick="OnToggleMenu">
            ☰
        </button>
    </div>

    <!-- CENTER: LOGO -->
    <div class="topbar-center">
        <span class="topbar-logo">Tvilum</span>
    </div>

    <!-- RIGHT: PROFILE -->
    <div class="topbar-right">

        <button class="profile-button" @onclick="ToggleProfile">
            <img src="image/Logo/ProfileLogo.png" alt="Profil"
                 class="profile-avatar" />

            @if (userState.IsLoggedIn)
            {
                <span class="profile-name">
                    @userState.CurrentUser.Name
                </span>
            }

            <span class="profile-arrow">▾</span>
        </button>

        @if (showProfileMenu)
        {
            <div class="profile-dropdown">

                @if (userState.IsLoggedIn)
                {
                    <button @onclick="Logout">Log ud</button>
                }
                else
                {
                    <button @onclick="GoToRegister">Opret bruger</button>
                    <button @onclick="GoToLogin">Log ind</button>
                }

            </div>
        }
    </div>
</div>

@code {
    private bool showProfileMenu = false;

    [Parameter]
    public EventCallback OnToggleMenu { get; set; }

    void ToggleProfile()
    {
        showProfileMenu = !showProfileMenu;
    }

    void GoToLogin()
    {
        navigationManager.NavigateTo("/Login");
    }

    void GoToRegister()
    {
        navigationManager.NavigateTo("/Register");
    }

    private async Task Logout()
    {
        await localStorage.RemoveItemAsync("currentUser");
        userState.CurrentUser = null;
        showProfileMenu = false;
        navigationManager.NavigateTo("/Home", true);
    }
}