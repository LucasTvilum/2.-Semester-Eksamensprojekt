@using Core.Models
@using ClientApp.Service
@using Blazored.LocalStorage
@inject IUser userService
@inject ILocalStorageService localStorage
@page "/AddUserTEMP"

<h3>Midlertidig tilf√∏j bruger/medarbejder</h3>

<EditForm Model="@user" OnValidSubmit="@HandleSubmit" class="row p-3">
<DataAnnotationsValidator />
<ValidationSummary />
    
<div class="col-md-12 mb-3">
    <label for="Name">Username</label>
    <InputText id="Name" @bind-Value="user.Username" class="form-control" />
</div>

    
<div class="col-md-12 mb-3">
    <label for="Name">Password</label>
    <InputText id="Password" @bind-Value="user.Password" type="password" class="form-control" />
</div>

<div class="col-md-12 mb-3">
    <label for="Category">Bruger typen</label>
    <InputSelect id="usertype" @bind-Value="user.Usertype">
        @foreach (var usertype in Enum.GetValues<User.UserType>())
        {
            <option value="@usertype">@User.GetLabel(usertype)</option>
        }
    </InputSelect>
</div>

<div class="col-12 mb-3">
    <button type="submit" class="btn btn-primary" >Opret Bruger</button>
</div>
    
<div class="col-12 mb-3">
    <button type="reset" class="btn btn-primary">Reset</button>
</div>

<!-- Kunde information fields -->
@if (user.Usertype == User.UserType.Customer)
{
    <div class="col-md-12 mb-3">
        <label for="CustomerCode">Customer Code</label>
        <InputText id="CustomerCode" @bind-Value="CustomerAddress" class="form-control" />
    </div>
    <div class="col-md-12 mb-3">
        <label for="Address">Address</label>
        <InputText id="Address" @bind-Value="CustomerRegion" class="form-control" />
    </div>
    <div class="col-md-12 mb-3">
        <label for="Address">Address</label>
        <InputText id="Address" @bind-Value="CustomerCity" class="form-control" />
    </div>
}

<!-- Worker (tom ligenu, worker har kun admin = true) -->



</EditForm> 

<div class="dropdown">
<button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
    @type
</button>

<ul class="dropdown-menu">
    @foreach (var value in Enum.GetValues<User.UserType>())
    {
        <li>
            <a class="dropdown-item" @onclick="() => SetType(value)">
                @value
            </a>
        </li>
    }
</ul>
</div>


@code {
    
    private User user = new User();
    
    private User.UserType type = User.UserType.User;
    
    private string CustomerAddress = "";
    private string CustomerRegion = "";
    private string CustomerCity = "";
    
    private void SetType(User.UserType newType)
    {
        type = newType;
    }

    private void HandleSubmit()
    {
        User newUser;

        switch (user.Usertype)
        {
            case User.UserType.Customer:
                newUser = new Customer
                {
                    Username = user.Username,
                    Password = user.Password
                    // Add any Customer-specific fields if needed
                };
                break;

            case User.UserType.Worker:
                newUser = new Worker
                {
                    Username = user.Username,
                    Password = user.Password
                    // Add any Worker-specific fields if needed
                };
                break;

            default: // User.UserType.User
                newUser = new User
                {
                    Username = user.Username,
                    Password = user.Password
                };
                break;
        }

        userService.Add(newUser);
        newUser = new User();
    }
    
    
    protected override async Task OnInitializedAsync()
    {
        //local storage implementation
        var loadedUser = await localStorage.GetItemAsync<User>("currentUser");
        
        if (loadedUser != null)
        {
            //Uncomment linje under
            //user = loadedUser;
        }
    }
    
}