@page "/PriceCalculator"
@using Core.Models
@using ClientApp.Components
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@inject NavigationManager nav

<h3>Price Calculator</h3>

<WindowPriceCalculator Booking="@booking" OnSelectBookingType="HandleBookingType" />

@code {
    private Booking booking = new();
    
    private async Task HandleBookingType(string type)
    {
        var user = await localStorage.GetItemAsync<User>("currentUser");

        if (user == null)
        {
            // gem booking før redirect
            await localStorage.SetItemAsync("pendingBooking", booking);
            await localStorage.SetItemAsync("returnType", type);

            nav.NavigateTo("/Register");
            return;
        }

        if (type == "Enkelt")
        {
            nav.NavigateTo("/OneTimeBooking");
        }
        else if (type == "Abonnement")
        {
            nav.NavigateTo("/SubscriptionBooking");
        }
    }
}